<svg viewBox="0 0 672 680" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <filter id="roughen" x="-2%" y="-2%" width="104%" height="104%">
      <feTurbulence type="turbulence" baseFrequency="0.03" numOctaves="2" result="noise" seed="17"/>
      <feDisplacementMap in="SourceGraphic" in2="noise" scale="1.1" xChannelSelector="R" yChannelSelector="G"/>
    </filter>
    <filter id="glow">
      <feGaussianBlur stdDeviation="3" result="blur"/>
      <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
    <marker id="arr" viewBox="0 0 12 10" refX="10" refY="5"
            markerWidth="8" markerHeight="6" orient="auto-start-reverse"
            fill="none" stroke="#e0e0e0" stroke-width="1.5"
            stroke-linecap="round" stroke-linejoin="round">
      <path d="M 1,1 L 10,5 L 1,9"/>
    </marker>
    <marker id="arr-green" viewBox="0 0 12 10" refX="10" refY="5"
            markerWidth="8" markerHeight="6" orient="auto-start-reverse"
            fill="none" stroke="#4ade80" stroke-width="1.5"
            stroke-linecap="round" stroke-linejoin="round">
      <path d="M 1,1 L 10,5 L 1,9"/>
    </marker>
    <marker id="arr-muted" viewBox="0 0 12 10" refX="10" refY="5"
            markerWidth="8" markerHeight="6" orient="auto-start-reverse"
            fill="none" stroke="#888888" stroke-width="1.5"
            stroke-linecap="round" stroke-linejoin="round">
      <path d="M 1,1 L 10,5 L 1,9"/>
    </marker>
  </defs>

  <!-- TITLE -->
  <text x="336" y="38" text-anchor="middle"
        font-family="'Caveat', 'Comic Sans MS', cursive"
        font-size="22" fill="#e0e0e0" font-weight="bold"
        transform="rotate(-0.5, 336, 38)">
    Green Module Architecture
  </text>
  <path d="M 140,46 C 230,48 440,44 532,47"
        stroke="#4ade80" stroke-width="1.5" fill="none"
        stroke-linecap="round" opacity="0.6"/>

  <!-- STAGE 1: Gateway UI / Green Tab -->
  <g transform="rotate(-0.3, 336, 100)">
    <circle cx="108" cy="72" r="14" fill="#4ade80" stroke="none" opacity="0.9"/>
    <text x="108" y="77" text-anchor="middle"
          font-family="'Caveat', 'Comic Sans MS', cursive"
          font-size="14" fill="white" font-weight="bold">1</text>
    <path d="M 132,60 C 230,57 430,63 542,59
             C 545,75 543,95 545,118
             C 430,121 230,117 132,121
             C 129,100 131,78 129,60"
          stroke="#4ade80" stroke-width="2" fill="rgba(74,222,128,0.08)"
          stroke-linecap="round" stroke-linejoin="round"/>
    <text x="338" y="82" text-anchor="middle"
          font-family="'Caveat', 'Comic Sans MS', cursive"
          font-size="15" fill="#e0e0e0" font-weight="bold">Gateway UI &#x2014; Green Tab</text>
    <text x="338" y="104" text-anchor="middle"
          font-family="'Caveat', 'Comic Sans MS', cursive"
          font-size="12" fill="#888888">dashboard for carbon metrics + reporting</text>
  </g>

  <path d="M 336,124 C 338,140 334,152 336,166"
        stroke="#e0e0e0" stroke-width="2" fill="none"
        stroke-linecap="round" marker-end="url(#arr)"/>

  <!-- STAGE 2: REST Endpoints -->
  <g transform="rotate(0.4, 336, 210)">
    <circle cx="108" cy="182" r="14" fill="#4ade80" stroke="none" opacity="0.9"/>
    <text x="108" y="187" text-anchor="middle"
          font-family="'Caveat', 'Comic Sans MS', cursive"
          font-size="14" fill="white" font-weight="bold">2</text>
    <path d="M 132,170 C 230,167 430,173 542,169
             C 545,188 543,214 545,238
             C 430,241 230,237 132,241
             C 129,218 131,190 129,170"
          stroke="#4ade80" stroke-width="2" fill="rgba(74,222,128,0.08)"
          stroke-linecap="round" stroke-linejoin="round"/>
    <text x="338" y="196" text-anchor="middle"
          font-family="'Caveat', 'Comic Sans MS', cursive"
          font-size="15" fill="#e0e0e0" font-weight="bold">REST API</text>
    <text x="338" y="218" text-anchor="middle"
          font-family="'Caveat', 'Comic Sans MS', cursive"
          font-size="12" fill="#888888">/openclaw/api/green/* endpoints</text>
  </g>

  <path d="M 336,244 C 338,260 334,272 336,286"
        stroke="#e0e0e0" stroke-width="2" fill="none"
        stroke-linecap="round" marker-end="url(#arr)"/>

  <!-- STAGE 3: Green Module (3 sub-components, glow) -->
  <g transform="rotate(-0.3, 336, 360)" filter="url(#glow)">
    <circle cx="108" cy="302" r="14" fill="#4ade80" stroke="none" opacity="0.9"/>
    <text x="108" y="307" text-anchor="middle"
          font-family="'Caveat', 'Comic Sans MS', cursive"
          font-size="14" fill="white" font-weight="bold">3</text>
    <path d="M 132,290 C 230,287 430,293 542,289
             C 545,318 543,374 545,408
             C 430,411 230,407 132,411
             C 129,378 131,320 129,290"
          stroke="#4ade80" stroke-width="2.5" fill="rgba(74,222,128,0.12)"
          stroke-linecap="round" stroke-linejoin="round"/>
    <text x="338" y="312" text-anchor="middle"
          font-family="'Caveat', 'Comic Sans MS', cursive"
          font-size="15" fill="#e0e0e0" font-weight="bold">Green Module</text>
    <text x="338" y="330" text-anchor="middle"
          font-family="'Caveat', 'Comic Sans MS', cursive"
          font-size="11" fill="#4ade80" opacity="0.8">(core)</text>

    <!-- Sub-component boxes -->
    <path d="M 148,344 C 150,342 230,342 232,344
             C 234,356 234,378 232,380
             C 230,382 150,382 148,380
             C 146,378 146,356 148,344"
          stroke="#888888" stroke-width="1.2" fill="rgba(74,222,128,0.05)"
          stroke-linecap="round" stroke-linejoin="round" opacity="0.6"/>
    <text x="190" y="360" text-anchor="middle"
          font-family="'Caveat', 'Comic Sans MS', cursive"
          font-size="11" fill="#e0e0e0">Carbon</text>
    <text x="190" y="374" text-anchor="middle"
          font-family="'Caveat', 'Comic Sans MS', cursive"
          font-size="11" fill="#e0e0e0">Calculator</text>

    <path d="M 248,344 C 250,342 420,342 422,344
             C 424,356 424,378 422,380
             C 420,382 250,382 248,380
             C 246,378 246,356 248,344"
          stroke="#888888" stroke-width="1.2" fill="rgba(74,222,128,0.05)"
          stroke-linecap="round" stroke-linejoin="round" opacity="0.6"/>
    <text x="336" y="360" text-anchor="middle"
          font-family="'Caveat', 'Comic Sans MS', cursive"
          font-size="11" fill="#e0e0e0">Carbon Store</text>
    <text x="336" y="374" text-anchor="middle"
          font-family="'Caveat', 'Comic Sans MS', cursive"
          font-size="11" fill="#888888">(SQLite)</text>

    <path d="M 438,344 C 440,342 530,342 532,344
             C 534,356 534,378 532,380
             C 530,382 440,382 438,380
             C 436,378 436,356 438,344"
          stroke="#888888" stroke-width="1.2" fill="rgba(74,222,128,0.05)"
          stroke-linecap="round" stroke-linejoin="round" opacity="0.6"/>
    <text x="486" y="360" text-anchor="middle"
          font-family="'Caveat', 'Comic Sans MS', cursive"
          font-size="11" fill="#e0e0e0">Grid Carbon</text>
    <text x="486" y="374" text-anchor="middle"
          font-family="'Caveat', 'Comic Sans MS', cursive"
          font-size="11" fill="#e0e0e0">Config</text>
  </g>

  <path d="M 336,414 C 338,430 334,442 336,456"
        stroke="#e0e0e0" stroke-width="2" fill="none"
        stroke-linecap="round" marker-end="url(#arr)"/>

  <!-- STAGE 4: Trace Capture -->
  <g transform="rotate(0.3, 336, 500)">
    <circle cx="108" cy="472" r="14" fill="#4ade80" stroke="none" opacity="0.9"/>
    <text x="108" y="477" text-anchor="middle"
          font-family="'Caveat', 'Comic Sans MS', cursive"
          font-size="14" fill="white" font-weight="bold">4</text>
    <path d="M 132,460 C 230,457 430,463 542,459
             C 545,478 543,504 545,528
             C 430,531 230,527 132,531
             C 129,508 131,480 129,460"
          stroke="#4ade80" stroke-width="2" fill="rgba(74,222,128,0.08)"
          stroke-linecap="round" stroke-linejoin="round"/>
    <text x="338" y="486" text-anchor="middle"
          font-family="'Caveat', 'Comic Sans MS', cursive"
          font-size="15" fill="#e0e0e0" font-weight="bold">Trace Capture</text>
    <text x="338" y="508" text-anchor="middle"
          font-family="'Caveat', 'Comic Sans MS', cursive"
          font-size="12" fill="#888888">per-request carbon traces (usage, model, tokens)</text>
  </g>

  <path d="M 336,534 C 338,550 334,562 336,576"
        stroke="#e0e0e0" stroke-width="2" fill="none"
        stroke-linecap="round" marker-end="url(#arr)"/>

  <!-- STAGE 5: Agent Execution -->
  <g transform="rotate(-0.4, 336, 610)">
    <circle cx="108" cy="592" r="14" fill="#4ade80" stroke="none" opacity="0.9"/>
    <text x="108" y="597" text-anchor="middle"
          font-family="'Caveat', 'Comic Sans MS', cursive"
          font-size="14" fill="white" font-weight="bold">5</text>
    <path d="M 132,580 C 230,577 430,583 542,579
             C 545,598 543,624 545,648
             C 430,651 230,647 132,651
             C 129,628 131,600 129,580"
          stroke="#4ade80" stroke-width="2" fill="rgba(74,222,128,0.08)"
          stroke-linecap="round" stroke-linejoin="round"/>
    <text x="338" y="606" text-anchor="middle"
          font-family="'Caveat', 'Comic Sans MS', cursive"
          font-size="15" fill="#e0e0e0" font-weight="bold">Agent Execution</text>
    <text x="338" y="628" text-anchor="middle"
          font-family="'Caveat', 'Comic Sans MS', cursive"
          font-size="12" fill="#888888">LLM inference &#x2192; carbon trace emitted per request</text>
  </g>

  <!-- EXTERNAL OUTPUT: Standards -->
  <path d="M 548,90 C 562,90 574,90 586,90"
        stroke="#888888" stroke-width="1.2" fill="none"
        stroke-linecap="round" stroke-dasharray="4 4"
        opacity="0.5"/>
  <text x="594" y="82" text-anchor="start"
        font-family="'Caveat', 'Comic Sans MS', cursive"
        font-size="11" fill="#888888" opacity="0.7">GHG Protocol</text>
  <text x="594" y="98" text-anchor="start"
        font-family="'Caveat', 'Comic Sans MS', cursive"
        font-size="11" fill="#888888" opacity="0.7">TCFD, CDP</text>

  <!-- BOTTOM CAPTION -->
  <text x="336" y="676" text-anchor="middle"
        font-family="'Caveat', 'Comic Sans MS', cursive"
        font-size="13" fill="#888888" opacity="0.7"
        transform="rotate(-0.3, 336, 676)">
    always-on carbon tracking from UI to per-request trace capture
  </text>
</svg>